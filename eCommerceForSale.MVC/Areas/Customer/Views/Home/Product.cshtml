@model ProductDetailsVM

@{
    var imagePaths = Model.ShoppingCart.Product.ImagePath.Split('~').Where(x => !string.IsNullOrEmpty(x)).ToList();
    //var description = Model.Product.Desciption.Substring(0, 99) + "...";
}
<div class="container-fliud p-2">
    <form method="post">
        <input type="hidden" asp-for="ShoppingCart.ProductId" />
        <div class="container">
            <div class="row">
                <div class="col-md-5">
                    <div id="product-carousal" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            @foreach (var image in imagePaths.Select((value, i) => new { i, value }))
                            {
                                <div class="carousel-item text-center @(image.i == 0? "active" : "")">
                                    <img src="@image.value" class="product-img-preview" />
                                </div>
                            }
                        </div>
                        <a class="carousel-control-prev" href="#product-carousal" role="button" data-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="sr-only">Previous</span>
                        </a>
                        <a class="carousel-control-next" href="#product-carousal" role="button" data-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="sr-only">Next</span>
                        </a>
                    </div>
                </div>
                <div class="details col-md-6 ml-2">
                    <h3 class="product-title">@Model.ShoppingCart.Product.ProductName</h3>
                    <div class="rating">
                        <div class="stars">
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star checked"></span>
                            <span class="fa fa-star"></span>
                        </div>
                        <span class="review-no">41 reviews</span>
                    </div>
                    @if (!Model.ShoppingCart.Product.IsBoxOrPack)
                    {
                        <div class="form-group">
                            <label for="Weight">Weight</label>
                            <input type="number" class="form-control" min="1">
                        </div>
                    }
                    else
                    {
                        <div class="form-group row mb-2">
                            <div class="col-1">
                                <label asp-for="ShoppingCart.Count" class="control-label font-weight-bold"></label>
                            </div>
                            <div class="col-2">
                                <input asp-for="ShoppingCart.Count" class="form-control" min="1" />
                                <span asp-validation-for="ShoppingCart.Count" class="text-danger"></span>
                            </div>
                        </div>
                    }
                    <h4 class="price">current price: &#122;&#322; <span>@Model.ShoppingCart.Product.Price</span></h4>
                    <p class="vote"><strong>91%</strong> of buyers enjoyed this product! <strong>(87 votes)</strong></p>

                    <div class="action">
                        <button type="submit" value="Add to Cart" class="btn btn-primary form-control" style="height:50px;"><i class="fas fa-shopping-cart"></i> Add to Cart</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="container mt-4">
        <h5 class="product-description">
            @Html.Raw(Model.ShoppingCart.Product.Desciption)
        </h5>
    </div>
    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-xs-12 col-md-6">
                <form>
                    <div class="form-group text-center">
                        <input type="number" class="rating" id="test" name="test" data-min="1" data-max="5" value="0">
                    </div>
                    <div class="form-group">
                        <textarea rows="2" class="form-control" placeholder="Your feedbach is valuable"></textarea>
                    </div>
                    <input type="submit" value="Submit feedback" class="form-control btn btn-block btn-outline-primary">
                </form>
            </div>
            <div class="col-xs-12 col-md-6">
                <div class="well well-sm">
                    <div class="row">
                        <div class="col-xs-12 col-md-6 text-center">
                            <h1 class="rating-num">
                                4.0
                            </h1>
                            <div class="rating">
                                <i class="fas fa-star"></i><i class="fas fa-star">
                                </i><i class="fas fa-star"></i><i class="fas fa-star">
                                </i><i class="far fa-star"></i>
                            </div>
                            <div>
                                <i class="fas fa-user"></i>41 total
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                            <div class="row rating-desc">
                                <div class="col-xs-3 col-md-3 text-right">
                                    <i class="fas fa-star"></i>5
                                </div>
                                <div class="col-xs-8 col-md-9">
                                    <div class="progress ">
                                        <div class="progress-bar progress-bar-striped bg-success" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                            <span class="sr-only">80%</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- end 5 -->
                                <div class="col-xs-3 col-md-3 text-right">
                                    <i class="fas fa-star"></i>4
                                </div>
                                <div class="col-xs-8 col-md-9">
                                    <div class="progress">
                                        <div class="progress-bar bg-success" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" aria-valuenow="60" style="width: 60%">
                                        </div>
                                    </div>
                                </div>
                                <!-- end 4 -->
                                <div class="col-xs-3 col-md-3 text-right">
                                    <i class="fas fa-star"></i>3
                                </div>
                                <div class="col-xs-8 col-md-9">
                                    <div class="progress">
                                        <div class="progress-bar bg-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 40%">
                                            <span class="sr-only">40%</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- end 3 -->
                                <div class="col-xs-3 col-md-3 text-right">
                                    <i class="fas fa-star"></i>2
                                </div>
                                <div class="col-xs-8 col-md-9">
                                    <div class="progress">
                                        <div class="progress-bar bg-warning" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                            <span class="sr-only">20%</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- end 2 -->
                                <div class="col-xs-3 col-md-3 text-right">
                                    <i class="fas fa-star"></i>1
                                </div>
                                <div class="col-xs-8 col-md-9">
                                    <div class="progress">
                                        <div class="progress-bar bg-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 15%">
                                            <span class="sr-only">15%</span>
                                        </div>
                                    </div>
                                </div>
                                <!-- end 1 -->
                            </div>
                            <!-- end row -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        (function ($) {

            $.fn.rating = function () {

                var element;

                // A private function to highlight a star corresponding to a given value
                function _paintValue(ratingInput, value) {
                    var selectedStar = $(ratingInput).find('[data-value=' + value + ']');
                    selectedStar.removeClass('far').addClass('fas');
                    selectedStar.prevAll('[data-value]').removeClass('far').addClass('fas');
                    selectedStar.nextAll('[data-value]').removeClass('fas').addClass('far');
                }

                // A private function to remove the selected rating
                function _clearValue(ratingInput) {
                    var self = $(ratingInput);
                    self.find('[data-value]').removeClass('fas').addClass('far');
                    self.find('.rating-clear').hide();
                    self.find('input').val('').trigger('change');
                }

                // Iterate and transform all selected inputs
                for (element = this.length - 1; element >= 0; element--) {

                    var el, i, ratingInputs,
                        originalInput = $(this[element]),
                        max = originalInput.data('max') || 5,
                        min = originalInput.data('min') || 0,
                        clearable = originalInput.data('clearable') || null,
                        stars = '';

                    // HTML element construction
                    for (i = min; i <= max; i++) {
                        // Create <max> empty stars
                        stars += ['<span class="far fa-star" data-value="', i, '"></span>'].join('');
                    }
                    // Add a clear link if clearable option is set
                    if (clearable) {
                        stars += [
                            ' <a class="rating-clear" style="display:none;" href="javascript:void">',
                            '<span class="fas fa-trash"></span> ',
                            clearable,
                            '</a>'
                        ].join('');
                    }

                    el = [
                        // Rating widget is wrapped inside a div
                        '<div class="rating-input">',
                        stars,
                        // Value will be hold in a hidden input with same name and id than original input so the form will still work
                        '<input type="hidden" name="',
                        originalInput.attr('name'),
                        '" value="',
                        originalInput.val(),
                        '" id="',
                        originalInput.attr('id'),
                        '" />',
                        '</div>'
                    ].join('');

                    // Replace original inputs HTML with the new one
                    originalInput.replaceWith(el);

                }

                // Give live to the newly generated widgets
                $('.rating-input')
                    // Highlight stars on hovering
                    .on('mouseenter', '[data-value]', function () {
                        var self = $(this);
                        _paintValue(self.closest('.rating-input'), self.data('value'));
                    })
                    // View current value while mouse is out
                    .on('mouseleave', '[data-value]', function () {
                        var self = $(this);
                        var val = self.siblings('input').val();
                        if (val) {
                            _paintValue(self.closest('.rating-input'), val);
                        } else {
                            _clearValue(self.closest('.rating-input'));
                        }
                    })
                    // Set the selected value to the hidden field
                    .on('click', '[data-value]', function (e) {
                        var self = $(this);
                        var val = self.data('value');
                        self.siblings('input').val(val).trigger('change');
                        self.siblings('.rating-clear').show();
                        e.preventDefault();
                        false
                    })
                    // Remove value on clear
                    .on('click', '.rating-clear', function (e) {
                        _clearValue($(this).closest('.rating-input'));
                        e.preventDefault();
                        false
                    })
                    // Initialize view with default value
                    .each(function () {
                        var val = $(this).find('input').val();
                        if (val) {
                            _paintValue(this, val);
                            $(this).find('.rating-clear').show();
                        }
                    });

            };

            // Auto apply conversion of number fields with class 'rating' into rating-fields
            $(function () {
                if ($('input.rating[type=number]').length > 0) {
                    $('input.rating[type=number]').rating();
                }
            });

        }(jQuery));
    </script>

}